<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide: MERN Stack (MongoDB, Express, React, Node.js)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 
        Chosen Palette: Warm Neutrals with Dark Accents (inspired by femi-ts-note.vercel.app)
        Application Structure Plan: The application now features a fixed header navigation bar at the top, replacing the left-side sidebar. This design prioritizes content readability and quick access to different sections via the header's smooth scroll-to-anchor functionality. On smaller screens, the header navigation will adapt to be horizontally scrollable to accommodate many links. New sections are added for React frontend setup and integration. Key interactive elements like tabbed CRUD operations and expandable schema options are retained and styled to integrate seamlessly with the new aesthetic, enhancing usability and content exploration. A search bar is included in the header for visual consistency.
        Visualization & Content Choices: The source material is a technical guide. Goal: Organize Content -> Viz: Fixed Header Navigation (scroll-to-anchor) + Search Input -> Interaction: Click to scroll to content sections, visual search bar, and automatic highlighting of active section on scroll -> Justification: Provides persistent navigation and a familiar UI pattern for content discovery, enhancing user orientation within the long-form content. Goal: Explain CRUD -> Viz: Tabbed component -> Interaction: Click to switch between Create/Read/Update/Delete code -> Justification: Efficiently presents related code snippets without overwhelming the user. Goal: Detail Schema Options -> Viz: Interactive, collapsible list -> Interaction: Click to expand/collapse details -> Justification: Allows users to explore details on demand, keeping the main view clean. Goal: Make Code Usable -> Viz: "Copy" button on code blocks -> Interaction: Click to copy to clipboard -> Justification: Improves developer workflow by making code snippets easily transferable. Goal: Introduce React Integration -> Viz: Dedicated React Frontend section with code blocks and live rendering -> Interaction: Live React component for user creation, demonstrating frontend-backend communication -> Justification: Provides practical, runnable examples of React's role in the MERN stack, making the learning experience hands-on and immediately verifiable. No charts are used as the content is purely instructional and textual.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .code-block {
            position: relative;
        }

        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(255, 255, 255, 0.1);
            /* Subtle white for dark background */
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s, background-color 0.2s;
        }

        .code-block:hover .copy-button {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            /* Lighter background for active */
            color: white;
            font-weight: 600;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.05);
            /* Even lighter hover */
        }

        .crud-tab {
            padding: 0.75rem 1rem;
            border-bottom-width: 2px;
            border-color: transparent;
            font-weight: 500;
            color: #6B7280;
            /* gray-500 */
            transition: all 0.2s;
        }

        .crud-tab:hover {
            color: #1F2937;
            /* gray-900 */
            border-color: #E5E7EB;
            /* gray-200 */
        }

        .crud-tab.active {
            border-color: #1F2937;
            /* gray-900 */
            color: #1F2937;
            font-weight: 600;
        }

        .schema-option-title {
            cursor: pointer;
            padding: 0.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            color: #374151;
            /* gray-700 */
            transition: color 0.2s;
        }

        .schema-option-title:hover {
            color: #1F2937;
            /* gray-900 */
        }

        .schema-option-content {
            display: none;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }

        .schema-option-content.active {
            display: block;
            max-height: 500px;
            /* Adjust as needed */
        }

        .plus-minus-icon {
            font-size: 1.2rem;
            line-height: 1;
            transform-origin: center;
        }

        .rotate-45 {
            transform: rotate(45deg);
        }

        /* Header Navigation Specific Styles */
        .header-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            /* Ensure it stays on top */
            height: auto;
            /* Height adapts to content */
            overflow-x: auto;
            /* Allow horizontal scrolling for nav links if they overflow */
            overflow-y: hidden;
            /* Prevent vertical scrolling */
            white-space: nowrap;
            /* Keep nav links on a single line */
            display: flex;
            /* Use flexbox for horizontal alignment */
            align-items: center;
            /* Vertically align items */
            padding: 0.5rem 1rem;
            /* Adjust padding */
            border-bottom: 1px solid #1F2937;
            /* Add bottom border */
        }

        .header-nav .nav-list {
            display: flex;
            flex-direction: row;
            /* Always horizontal */
            align-items: center;
            gap: 0.5rem;
            /* Gap between nav items */
            padding: 0;
            /* Remove default ul padding */
            margin: 0;
            /* Remove default ul margin */
        }

        .header-nav .nav-link {
            padding: 0.5rem 0.75rem;
            /* Compact padding for horizontal links */
            font-size: 0.875rem;
            /* Smaller font size for links */
            display: flex;
            /* Ensure icon and text are inline */
            align-items: center;
        }

        .header-nav .nav-link span {
            margin-right: 0.5rem;
            /* Space between icon and text */
            font-size: 1rem;
            /* Adjust icon size */
            display: inline-block;
            /* Ensure icons are always visible */
        }

        .header-nav h1 {
            flex-shrink: 0;
            /* Prevent title from shrinking */
            margin-right: 1.5rem;
            /* Space between title and search/nav */
            margin-bottom: 0;
            /* Remove bottom margin */
        }

        .header-nav .search-input-container {
            flex-grow: 1;
            /* Allow search input to take available space */
            max-width: 200px;
            /* Limit search input width */
            margin-right: 1rem;
            /* Space after search input */
        }

        /* Adjust main content padding to account for fixed header */
        .main-content-padding {
            padding-top: 5rem;
            /* Adjust this value based on your header's actual height */
        }

        /* Responsive adjustments for header on smaller screens */
        @media (max-width: 767px) {
            .header-nav {
                flex-wrap: wrap;
                /* Allow items to wrap on smaller screens */
                justify-content: center;
                /* Center items when wrapped */
                padding: 0.75rem 0.5rem;
                /* More vertical padding for wrapped content */
            }

            .header-nav h1 {
                width: 100%;
                /* Title takes full width */
                text-align: center;
                margin-bottom: 0.5rem;
                /* Add some space below title */
                margin-right: 0;
                /* Remove right margin */
            }

            .header-nav .search-input-container {
                width: 100%;
                /* Search input takes full width */
                max-width: none;
                /* Remove max-width constraint */
                margin-bottom: 0.5rem;
                /* Add space below search */
                margin-right: 0;
                /* Remove right margin */
            }

            .header-nav .nav-list {
                width: 100%;
                /* Nav list takes full width */
                justify-content: center;
                /* Center nav items */
                overflow-x: auto;
                /* Ensure horizontal scrolling for nav links */
                padding-bottom: 0.5rem;
                /* Add padding for scrollbar */
            }

            .header-nav .nav-link {
                padding: 0.4rem 0.6rem;
                /* Even smaller padding for very small screens */
                font-size: 0.8rem;
                /* Even smaller font size */
            }

            .header-nav .nav-link span {
                margin-right: 0.25rem;
                /* Reduce icon margin */
            }

            .main-content-padding {
                padding-top: 8rem;
                /* Increase padding for smaller screens if header wraps */
            }
        }

        @media (min-width: 768px) {
            .header-nav {
                flex-wrap: nowrap;
                /* Prevent wrapping on larger screens */
                justify-content: flex-start;
                /* Align items to start */
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">

    <!-- Header Navigation -->
    <nav class="w-full bg-gray-900 text-gray-200 header-nav">
        <h1 class="text-2xl font-bold text-white">
            <span class="text-blue-400">MERN</span> Stack Guide
        </h1>

        <div class="search-input-container">
            <input type="text" placeholder="Search guide..."
                class="w-full p-2 rounded-md bg-gray-800 text-gray-200 border border-gray-700 focus:outline-none focus:border-blue-500 placeholder-gray-500">
        </div>

        <ul class="nav-list">
            <li><a href="#overview" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700 active"
                    data-target="overview">
                    <span>&#128218;</span> Overview
                </a></li>
            <li><a href="#setup" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700"
                    data-target="setup">
                    <span>&#128187;</span> Setup
                </a></li>
            <li><a href="#connection" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700"
                    data-target="connection">
                    <span>&#128279;</span> Backend
                </a></li>
            <li><a href="#schema" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700"
                    data-target="schema">
                    <span>&#128203;</span> Schema
                </a></li>
            <li><a href="#crud" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700"
                    data-target="crud">
                    <span>&#128196;</span> CRUD
                </a></li>
            <li><a href="#react-frontend" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700"
                    data-target="react-frontend">
                    <span>&#128187;</span> React
                </a></li>
            <li><a href="#run" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700"
                    data-target="run">
                    <span>&#128640;</span> Test
                </a></li>
            <li><a href="#best-practices" class="nav-link rounded-lg transition-colors duration-200 hover:bg-gray-700"
                    data-target="best-practices">
                    <span>&#128200;</span> Best Practices
                </a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 p-6 pt-26 md:p-10 space-y-12 bg-white main-content-padding">
        <div id="overview" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">Overview & Prerequisites</h2>
            <p class="mb-6 text-lg text-gray-700">This guide provides a comprehensive walkthrough for building a **MERN
                stack** application, combining **MongoDB** (database), **Express.js** (backend framework), **React**
                (frontend library), and **Node.js** (runtime environment). You'll learn how to set up your project,
                define data models, perform CRUD operations, and build an interactive React frontend that communicates
                with your backend. This section outlines the tools you'll need to follow along.</p>
            <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                <h3 class="text-xl font-semibold mb-4 text-gray-800">Prerequisites</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li><b>Node.js and npm:</b> Required for running the application and managing packages. Download
                        from <a href="https://nodejs.org/" target="_blank"
                            class="text-blue-600 hover:underline">nodejs.org</a>.</li>
                    <li><b>MongoDB:</b> Your database. You can run it locally or use a cloud service.
                        <ul class="list-['-_'] list-inside ml-6 mt-1 space-y-1">
                            <li><b>Local:</b> Install MongoDB Community Server from <a
                                    href="https://www.mongodb.com/try/download/community" target="_blank"
                                    class="text-blue-600 hover:underline">mongodb.com</a>.</li>
                            <li><b>Cloud (Recommended):</b> Set up a free cluster on <a
                                    href="https://www.mongodb.com/cloud/atlas" target="_blank"
                                    class="text-blue-600 hover:underline">MongoDB Atlas</a>.</li>
                        </ul>
                    </li>
                    <li><b>Text Editor:</b> A code editor like VS Code is recommended.</li>
                </ul>
            </div>
        </div>

        <div id="setup" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">Initial Setup</h2>
            <p class="mb-6 text-lg text-gray-700">This section walks you through the initial steps of creating your
                Node.js project, installing the necessary libraries, and configuring your environment to securely
                connect to your database. Follow these steps to build the foundation of your backend application.</p>

            <div class="space-y-8">
                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">1. Set up your Node.js Project</h3>
                    <p class="mb-4 text-gray-700">Create a new directory for your project and initialize it with npm.
                    </p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-bash">mkdir my-mern-app
cd my-mern-app
npm init -y</code></pre>
                    </div>
                </div>

                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">2. Install Backend Packages</h3>
                    <p class="mb-4 text-gray-700">Install Express for the server, Mongoose for MongoDB interaction,
                        Dotenv for environment variables, and `cors` for handling cross-origin requests from your React
                        frontend.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-bash">npm install express mongoose dotenv cors</code></pre>
                    </div>
                </div>

                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">3. Create a `.env` file</h3>
                    <p class="mb-4 text-gray-700">Create a `.env` file in your project's root directory. This file will
                        store your database connection string, keeping it separate from your code. Remember to replace
                        the placeholder with your actual connection string from MongoDB Atlas.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-bash">MONGO_URI=mongodb+srv://&lt;username&gt;:&lt;password&gt;@cluster0.abcde.mongodb.net/myDatabase?retryWrites=true&w=majority</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div id="connection" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">Backend Connection (Node.js & Express)</h2>
            <p class="mb-6 text-lg text-gray-700">Here is the core code for connecting your Node.js application to
                MongoDB using Mongoose. This snippet sets up a basic Express server, establishes the database connection
                using the URI from your `.env` file, and includes the `cors` middleware, which is crucial for allowing
                your React frontend to make requests to this backend.</p>
            <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                <pre><code class="language-javascript">// server.js

require('dotenv').config(); // Load environment variables from .env file
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors'); // Import cors middleware
const User = require('./models/User'); // Assuming User model is defined

const app = express();
const PORT = process.env.PORT || 5000;

// Middleware to parse JSON bodies
app.use(express.json());

// Enable CORS for all origins (for development)
app.use(cors()); 

// Connect to MongoDB
mongoose.connect(process.env.MONGO_URI)
    .then(() => {
        console.log('MongoDB connected successfully!');
    })
    .catch((err) => {
        console.error('MongoDB connection error:', err);
    });

// Basic route
app.get('/', (req, res) => {
    res.send('Welcome to the MERN Stack Backend!');
});

// Example route for creating a user (for testing with the form)
app.post('/users', async (req, res) => {
    try {
        const newUser = new User(req.body);
        const savedUser = await newUser.save();
        res.status(201).json(savedUser);
    } catch (err) {
        res.status(400).json({ message: err.message });
    }
});

app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});</code></pre>
            </div>
        </div>

        <div id="schema" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">Schema & Models</h2>
            <p class="mb-6 text-lg text-gray-700">A Mongoose Schema defines the structure of your documents within a
                MongoDB collection. This is where you enforce data types, validation, and default values. Below is an
                example of a `User` schema. You can explore the different options available to customize your data model
                by clicking on them.</p>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">Example: `User.js`</h3>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-javascript">// models/User.js

const mongoose = require('mongoose');

// Define the User Schema
const userSchema = new mongoose.Schema({
    name: {
        type: String,
        required: true,
        trim: true
    },
    email: {
        type: String,
        required: true,
        unique: true,
        lowercase: true,
        match: [/.+@.+\..+/, 'Please fill a valid email address']
    },
    age: {
        type: Number,
        min: 0,
        max: 120
    },
    isActive: {
        type: Boolean,
        default: true
    },
    createdAt: {
        type: Date,
        default: Date.now
    }
});

// Create and export the User model
const User = mongoose.model('User', userSchema);

module.exports = User;</code></pre>
                    </div>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Common Schema Options</h3>
                    <div id="schema-options-container" class="space-y-2">
                        <!-- Options will be injected by JS -->
                    </div>
                </div>
            </div>
        </div>

        <div id="crud" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">CRUD Operations (Backend)</h2>
            <p class="mb-6 text-lg text-gray-700">Once your model is defined, you can use it to perform Create, Read,
                Update, and Delete (CRUD) operations. This section provides the Express.js code for a basic API to
                manage users. Use the tabs to switch between different operations.</p>

            <div class="border-b border-gray-200 mb-4">
                <nav class="flex space-x-2 sm:space-x-4" id="crud-tabs">
                    <button class="crud-tab whitespace-nowrap active" data-target="crud-create">CREATE</button>
                    <button class="crud-tab whitespace-nowrap" data-target="crud-read">READ</button>
                    <button class="crud-tab whitespace-nowrap" data-target="crud-update">UPDATE</button>
                    <button class="crud-tab whitespace-nowrap" data-target="crud-delete">DELETE</button>
                </nav>
            </div>

            <div id="crud-content" class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                <div id="crud-create" class="crud-content-panel active">
                    <p class="mb-4 text-gray-700">Create a new user by sending a POST request to `/users` with the user
                        data in the request body.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-javascript">// 1. Create a new user (POST /users)
app.post('/users', async (req, res) => {
    try {
        const newUser = new User(req.body);
        const savedUser = await newUser.save();
        res.status(201).json(savedUser);
    } catch (err) {
        res.status(400).json({ message: err.message });
    }
});</code></pre>
                    </div>
                </div>
                <div id="crud-read" class="crud-content-panel" style="display:none;">
                    <p class="mb-4 text-gray-700">Read users from the database. You can either fetch all users with a
                        GET request to `/users` or a single user by their ID with a GET request to `/users/:id`.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-javascript">// 2. Get all users (GET /users)
app.get('/users', async (req, res) => {
    try {
        const users = await User.find();
        res.status(200).json(users);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
});

// 3. Get a single user by ID (GET /users/:id)
app.get('/users/:id', async (req, res) => {
    try {
        const user = await User.findById(req.params.id);
        if (!user) {
            return res.status(404).json({ message: 'User not found' });
        }
        res.status(200).json(user);
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
});</code></pre>
                    </div>
                </div>
                <div id="crud-update" class="crud-content-panel" style="display:none;">
                    <p class="mb-4 text-gray-700">Update an existing user by sending a PUT request to `/users/:id` with
                        the updated data in the request body.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-javascript">// 4. Update a user by ID (PUT /users/:id)
app.put('/users/:id', async (req, res) => {
    try {
        const updatedUser = await User.findByIdAndUpdate(
            req.params.id,
            req.body,
            { new: true, runValidators: true }
        );
        if (!updatedUser) {
            return res.status(404).json({ message: 'User not found' });
        }
        res.status(200).json(updatedUser);
    } catch (err) {
        res.status(400).json({ message: err.message });
    }
});</code></pre>
                    </div>
                </div>
                <div id="crud-delete" class="crud-content-panel" style="display:none;">
                    <p class="mb-4 text-gray-700">Delete a user by sending a DELETE request to `/users/:id`.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-javascript">// 5. Delete a user by ID (DELETE /users/:id)
app.delete('/users/:id', async (req, res) => {
    try {
        const deletedUser = await User.findByIdAndDelete(req.params.id);
        if (!deletedUser) {
            return res.status(404).json({ message: 'User not found' });
        }
        res.status(200).json({ message: 'User deleted successfully' });
    } catch (err) {
        res.status(500).json({ message: err.message });
    }
});</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <div id="react-frontend" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">React Frontend</h2>
            <p class="mb-6 text-lg text-gray-700">React will serve as your frontend library, providing a component-based
                approach to building dynamic user interfaces. Below is a basic React component that demonstrates how to
                create a user and fetch a list of users from your Node.js backend. This section also includes a live
                interactive demo.</p>

            <div class="space-y-8">
                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">React `App` Component (`App.js` conceptual)
                    </h3>
                    <p class="mb-4 text-gray-700">This code defines a simple React component that allows you to create a
                        new user and displays a list of existing users fetched from your backend. Pay attention to the
                        `fetch` calls for interacting with your Node.js API.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-jsx">
// This code would typically be in a file like src/App.js in a React project.
// For this single HTML file, it's embedded and transpiled by Babel.

function App() {
    const [name, setName] = React.useState('');
    const [email, setEmail] = React.useState('');
    const [age, setAge] = React.useState('');
    const [responseMessage, setResponseMessage] = React.useState('');
    const [users, setUsers] = React.useState([]);
    const [loading, setLoading] = React.useState(false);

    const API_BASE_URL = 'http://localhost:5000'; // Your Node.js backend URL

    const fetchUsers = async () => {
        setLoading(true);
        try {
            const res = await fetch(`${API_BASE_URL}/users`);
            const data = await res.json();
            setUsers(data);
        } catch (error) {
            console.error('Failed to fetch users:', error);
            // Updated error message for clarity
            setResponseMessage('Error: Could not connect to backend. Please ensure your Node.js server is running at ' + API_BASE_URL + ' in a separate terminal.');
        } finally {
            setLoading(false);
        }
    };

    React.useEffect(() => {
        fetchUsers(); // Fetch users on component mount
    }, []);

    const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setResponseMessage('');

        const userData = { name, email };
        if (age) {
            userData.age = parseInt(age, 10);
        }

        try {
            const res = await fetch(`${API_BASE_URL}/users`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData),
            });

            const data = await res.json();

            if (res.ok) {
                setResponseMessage('User created successfully: ' + JSON.stringify(data, null, 2));
                setName('');
                setEmail('');
                setAge('');
                fetchUsers(); // Refresh user list
            } else {
                setResponseMessage('Error: ' + (data.message || JSON.stringify(data, null, 2)));
            }
        } catch (error) {
            console.error('Submission error:', error);
            // Updated error message for clarity
            setResponseMessage('Submission failed. Check if your Node.js server is running at ' + API_BASE_URL + ' in a separate terminal and try again.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="space-y-6">
            <h3 className="text-xl font-semibold text-gray-800">Create New User (React Form)</h3>
            <form onSubmit={handleSubmit} className="space-y-4 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <div>
                    <label htmlFor="reactName" className="block text-sm font-medium text-gray-700">Name</label>
                    <input
                        type="text"
                        id="reactName"
                        value={name}
                        onChange={(e) => setName(e.target.value)}
                        required
                        className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white text-gray-900"
                    />
                </div>
                <div>
                    <label htmlFor="reactEmail" className="block text-sm font-medium text-gray-700">Email</label>
                    <input
                        type="email"
                        id="reactEmail"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        required
                        className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white text-gray-900"
                    />
                </div>
                <div>
                    <label htmlFor="reactAge" className="block text-sm font-medium text-gray-700">Age</label>
                    <input
                        type="number"
                        id="reactAge"
                        value={age}
                        onChange={(e) => setAge(e.target.value)}
                        className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white text-gray-900"
                    />
                </div>
                <button
                    type="submit"
                    className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out"
                    disabled={loading}
                >
                    {loading ? 'Creating...' : 'Create User'}
                </button>
            </form>

            {responseMessage && (
                <div className={`p-3 rounded-md text-sm ${responseMessage.startsWith('Error') ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`}>
                    <pre>{responseMessage}</pre>
                    </div>
                    )}

                    <h3 className="text-xl font-semibold text-gray-800 mt-8">Existing Users</h3>
                    {loading && <p>Loading users...</p>}
                    {!loading && users.length === 0 && <p>No users found. Create one above! دستیاب نہیں ہے!</p>}
                    {!loading && users.length > 0 && (
                    <ul className="space-y-2 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                        {users.map(user => (
                        <li key={user._id} className="p-2 border-b border-gray-100 last:border-b-0">
                            <b>Name:</b> {user.name} <br />
                            <b>Email:</b> {user.email} <br />
                            <b>Age:</b> {user.age || 'N/A'}
                        </li>
                        ))}
                    </ul>
                    )}
                </div>
                );
                }
                </code></pre>
            </div>
        </div>

        <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
            <h3 class="text-xl font-semibold mb-2 text-gray-800">Live React Demo</h3>
            <p class="mb-4 text-gray-700">This is a live rendering of the React component above. Ensure your Node.js
                backend is running on `http://localhost:5000` to interact with it.</p>
            <div id="react-root" class="p-4 bg-gray-100 rounded-lg shadow-inner border border-gray-300">
                <!-- React app will be mounted here -->
            </div>
        </div>
        </div>
        </div>

        <div id="run" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">Run & Test (MERN Stack)</h2>
            <p class="mb-6 text-lg text-gray-700">To test your full MERN stack application, you need to run both your
                Node.js backend and open this HTML file in your browser. The React frontend within this HTML file will
                then communicate with your running backend.</p>
            <div class="space-y-8">
                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">1. Run Your Node.js Backend</h3>
                    <p class="mb-4 text-gray-700">Navigate to your `my-mern-app` project directory in the terminal and
                        run your `server.js` file. This will start your Express server on `http://localhost:5000`.</p>
                    <div class="code-block bg-gray-800 text-white p-4 rounded-lg">
                        <button class="copy-button" onclick="copyCode(this)">Copy</button>
                        <pre><code class="language-bash">node server.js</code></pre>
                    </div>
                    <p class="mt-4 text-gray-700"><strong class="text-red-500 font-bold">It is critical to keep this
                            terminal window open and running while you interact with the frontend!</strong></p>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">2. Open the React Frontend</h3>
                    <p class="mb-4 text-gray-700">Simply open this HTML file (`index.html` if you saved it) directly in
                        your web browser. The embedded React application will automatically load and attempt to connect
                        to your running Node.js backend. Use the "Live React Demo" section above to interact with your
                        backend.</p>
                </div>
            </div>
        </div>

        <div id="best-practices" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-gray-900">Important Considerations & Best Practices</h2>
            <p class="mb-6 text-lg text-gray-700">Building a robust MERN stack application goes beyond the basics. This
                final section highlights key practices you should adopt for creating secure, scalable, and maintainable
                applications.</p>
            <div class="bg-gray-50 p-6 rounded-xl shadow-sm border border-gray-200">
                <ul class="list-disc list-inside space-y-3 text-gray-700">
                    <li><b>Error Handling:</b> Implement more robust error handling for production applications, both in
                        backend (Express) and frontend (React).</li>
                    <li><b>Input Validation:</b> Use validation libraries (e.g., `Joi` on backend, form validation in
                        React) for comprehensive input validation.</li>
                    <li><b>Password Hashing:</b> For user authentication, <b>never store passwords in plain text</b>.
                        Use libraries like `bcrypt.js` to hash passwords before saving them.</li>
                    <li><b>Authentication & Authorization:</b> Secure your API endpoints with proper authentication
                        (e.g., JWT) and authorization mechanisms across both frontend and backend.</li>
                    <li><b>Project Structure:</b> For larger applications, organize your code into separate folders for
                        backend (e.g., `server/`) and frontend (e.g., `client/` or `frontend/`), typically using tools
                        like Create React App or Vite for the frontend.</li>
                    <li><b>Indexes:</b> For fields frequently queried, add indexes to your Mongoose schemas to improve
                        database performance (e.g., `email: { type: String, unique: true, index: true }`).</li>
                    <li><b>Environment Variables:</b> Always use environment variables for sensitive data like database
                        connection strings.</li>
                    <li><b>CORS Policies:</b> For production, configure CORS more restrictively, allowing requests only
                        from your specific frontend domain(s).</li>
                </ul>
            </div>
        </div>

    </main>
    </div>

    <script type="text/babel">
        // This code is transpiled by Babel loaded from CDN
        const { useState, useEffect } = React;

        function App() {
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [age, setAge] = useState('');
            const [responseMessage, setResponseMessage] = useState('');
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(false);

            const API_BASE_URL = 'http://localhost:5000'; // Your Node.js backend URL

            const fetchUsers = async () => {
                setLoading(true);
                try {
                    const res = await fetch(`${API_BASE_URL}/users`);
                    const data = await res.json();
                    setUsers(data);
                } catch (error) {
                    console.error('Failed to fetch users:', error);
                    // Updated error message for clarity
                    setResponseMessage('Error: Could not connect to backend. Please ensure your Node.js server is running at ' + API_BASE_URL + ' in a separate terminal.');
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchUsers(); // Fetch users on component mount
            }, []);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setResponseMessage('');

                const userData = { name, email };
                if (age) {
                    userData.age = parseInt(age, 10);
                }

                try {
                    const res = await fetch(`${API_BASE_URL}/users`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userData),
                    });

                    const data = await res.json();

                    if (res.ok) {
                        setResponseMessage('User created successfully: ' + JSON.stringify(data, null, 2));
                        setName('');
                        setEmail('');
                        setAge('');
                        fetchUsers(); // Refresh user list
                    } else {
                        setResponseMessage('Error: ' + (data.message || JSON.stringify(data, null, 2)));
                    }
                } catch (error) {
                    console.error('Submission error:', error);
                    // Updated error message for clarity
                    setResponseMessage('Submission failed. Check if your Node.js server is running at ' + API_BASE_URL + ' in a separate terminal and try again.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="space-y-6">
                    <h3 className="text-xl font-semibold text-gray-800">Create New User (React Form)</h3>
                    <form onSubmit={handleSubmit} className="space-y-4 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                        <div>
                            <label htmlFor="reactName" className="block text-sm font-medium text-gray-700">Name</label>
                            <input
                                type="text"
                                id="reactName"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                required
                                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white text-gray-900"
                            />
                        </div>
                        <div>
                            <label htmlFor="reactEmail" className="block text-sm font-medium text-gray-700">Email</label>
                            <input
                                type="email"
                                id="reactEmail"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                required
                                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white text-gray-900"
                            />
                        </div>
                        <div>
                            <label htmlFor="reactAge" className="block text-sm font-medium text-gray-700">Age</label>
                            <input
                                type="number"
                                id="reactAge"
                                value={age}
                                onChange={(e) => setAge(e.target.value)}
                                className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white text-gray-900"
                            />
                        </div>
                        <button
                            type="submit"
                            className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out"
                            disabled={loading}
                        >
                            {loading ? 'Creating...' : 'Create User'}
                        </button>
                    </form>

                    {responseMessage && (
                        <div className={`p-3 rounded-md text-sm ${responseMessage.startsWith('Error') ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`}>
                            <pre>{responseMessage}</pre>
                        </div>
                    )}

                    <h3 className="text-xl font-semibold text-gray-800 mt-8">Existing Users</h3>
                    {loading && <p>Loading users...</p>}
                    {!loading && users.length === 0 && <p>No users found. Create one above!</p>}
                    {!loading && users.length > 0 && (
                        <ul className="space-y-2 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                            {users.map(user => (
                                <li key={user._id} className="p-2 border-b border-gray-100 last:border-b-0">
                                    <b>Name:</b> {user.name} <br />
                                    <b>Email:</b> {user.email} <br />
                                    <b>Age:</b> {user.age || 'N/A'}
                                </li>
                            ))}
                        </ul>
                    )}
                </div>
            );
        }

        // Mount the React App
        const reactRootElement = document.getElementById('react-root');
        if (reactRootElement) {
            const root = ReactDOM.createRoot(reactRootElement);
            root.render(<App />);
        }

    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');

            // Function to update active link
            function updateActiveNavLink() {
                let currentActiveSectionId = '';
                // Adjust this offset based on your header's height
                const headerHeight = document.querySelector('.header-nav').offsetHeight;
                const offset = headerHeight + 20; // A little extra buffer

                for (let i = 0; i < contentSections.length; i++) {
                    const section = contentSections[i];
                    const rect = section.getBoundingClientRect();
                    // Check if the top of the section is within the viewport, with an offset from the header
                    if (rect.top <= offset && rect.bottom >= offset) {
                        currentActiveSectionId = section.id;
                        break;
                    }
                }

                navLinks.forEach(link => {
                    if (link.getAttribute('data-target') === currentActiveSectionId) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }

            // Initial highlight on load
            updateActiveNavLink();

            // Event listener for scroll
            window.addEventListener('scroll', updateActiveNavLink);


            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    const targetElement = document.getElementById(targetId);
                    const headerOffset = document.querySelector('.header-nav').offsetHeight;
                    const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - headerOffset - 10; // Add a small buffer

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: "smooth"
                    });

                    // Manually update active class immediately on click
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');
                });
            });

            const crudTabs = document.querySelectorAll('.crud-tab');
            const crudPanels = document.querySelectorAll('.crud-content-panel');

            crudTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = tab.getAttribute('data-target');

                    crudTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    crudPanels.forEach(panel => {
                        panel.style.display = panel.id === targetId ? 'block' : 'none';
                    });
                });
            });

            const schemaOptionsData = [
                { title: 'type', description: 'The data type for the field (e.g., String, Number, Date, Boolean, Array, ObjectId).', code: 'name: { type: String }' },
                { title: 'required', description: 'If true, this field must have a value.', code: 'name: { required: true }' },
                { title: 'unique', description: 'Creates a unique index for this field, preventing duplicate values.', code: 'email: { unique: true }' },
                { title: 'default', description: 'Sets a default value if one is not provided.', code: 'isActive: { default: true }' },
                { title: 'trim', description: 'For String types, removes whitespace from the beginning and end.', code: 'name: { trim: true }' },
                { title: 'lowercase / uppercase', description: 'For String types, converts the value to the specified case.', code: 'email: { lowercase: true }' },
                { title: 'min / max', description: 'For Number and Date types, sets minimum and maximum allowed values.', code: 'age: { min: 18, max: 65 }' },
                { title: 'enum', description: 'For String types, specifies a list of allowed values.', code: 'status: { type: String, enum: ["pending", "active", "archived"] }' },
                { title: 'match', description: 'For String types, provides a regular expression for validation.', code: 'zipCode: { match: /^\\d{5}$/ }' },
                { title: 'ref', description: 'For ObjectId types, defines a relationship to another collection/model.', code: 'author: { type: mongoose.Schema.Types.ObjectId, ref: "User" }' }
            ];

            const optionsContainer = document.getElementById('schema-options-container');
            schemaOptionsData.forEach((opt, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'border-b border-gray-200 py-2';
                optionDiv.innerHTML = `
                    <div class="schema-option-title flex justify-between items-center">
                        <span>${opt.title}</span>
                        <span class="plus-minus-icon transform transition-transform duration-300">&#43;</span>
                    </div>
                    <div class="schema-option-content mt-2 pl-2">
                        <p class="text-sm text-gray-600 mb-2">${opt.description}</p>
                        <div class="code-block bg-gray-800 text-white p-2 rounded">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code class="language-javascript">${opt.code}</code></pre>
                        </div>
                    </div>
                `;
                optionsContainer.appendChild(optionDiv);
            });

            document.querySelectorAll('.schema-option-title').forEach(title => {
                title.addEventListener('click', () => {
                    const content = title.nextElementSibling;
                    const icon = title.querySelector('.plus-minus-icon');
                    const isActive = content.classList.contains('active');

                    // Close all others
                    document.querySelectorAll('.schema-option-content.active').forEach(openContent => {
                        if (openContent !== content) {
                            openContent.classList.remove('active');
                            const openIcon = openContent.previousElementSibling.querySelector('.plus-minus-icon');
                            openIcon.innerHTML = '&#43;';
                            openIcon.classList.remove('rotate-45');
                        }
                    });

                    // Toggle current
                    content.classList.toggle('active');
                    if (!isActive) {
                        icon.innerHTML = '&#8722;'; // Minus sign
                        icon.classList.add('rotate-45');
                    } else {
                        icon.innerHTML = '&#43;'; // Plus sign
                        icon.classList.remove('rotate-45');
                    }
                });
            });
        });

        function copyCode(button) {
            const codeBlock = button.parentElement;
            const code = codeBlock.querySelector('pre code').innerText;

            // Using execCommand for iframe compatibility
            const textarea = document.createElement('textarea');
            textarea.value = code;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                button.innerText = 'Copied!';
            } catch (err) {
                button.innerText = 'Failed!';
                console.error('Failed to copy text: ', err);
            }
            document.body.removeChild(textarea);

            setTimeout(() => {
                button.innerText = 'Copy';
            }, 2000);
        }
    </script>
</body>

</html>